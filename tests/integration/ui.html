<!DOCTYPE html>
<html>
	<head>
	</head>
	<body>
		<script>
var dojoConfig = {
	async: true,
	baseUrl: '../../../',
	packages: [
		'dojo',
		'dijit',
		'dstore',
		'framework'
	]
};
		</script>
		<script src="../../../dojo/dojo.js"></script>
		<script>
require([
	'framework/Model',
	'framework/Application',
	'framework/Mediator',
	'framework/ModelProxty',
	'framework/ui/Widget',
	'framework/ui/Widget!Master',
	'framework/ui/Widget!form/Input',
	'framework/ui/Widget!form/Error',
	'framework/ui/dom/Element',
	'framework/templating/html'
], function (Model, Application, Mediator, ModelProxty, Widget, Master, Input, FormError, Element, Parser) {
	var app = window.app = new Application({
		modules: { router: null }
	});

	var MyModel = function () {
		this.firstName = new ModelProxty({
			default: 'Joe',
			validators: [ {
				validate: function (model, key, value) {
					value !== 'Joe' && model.addError(key, 'No, you must be Joe!');
				}
			} ]
		});
		this.lastName = new ModelProxty({
			default: 'Bloggs'
		});
		this.favoriteColor = new ModelProxty({
			default: 'red'
		});
		Model.apply(this, arguments);
	};
	MyModel.prototype = new Model();
	MyModel.prototype.constructor = MyModel;

	var MyMediator = function () {
		// this.firstName = new ModelProxty({
		// 	get: function () {
		// 		return 'farts';
		// 	}
		// });
		Mediator.apply(this, arguments);
	};
	MyMediator.prototype = new Mediator();
	MyMediator.prototype.constructor = MyMediator;

	app.startup().then(function () {
		var firstNameRE = /^[a-zA-Z]+$/;
		var model = window.model = new MyModel();
		var mediator = window.mediator = new MyMediator({
			app: app,
			model: model
		});

		var masterView = new Master({});
		masterView.attachToWindow(document.body);

		var template = [
			'First Name: <widget is="!form/Input" value="{firstName}"></widget> ',
			'Errors: <widget is="!form/Error" binding="firstName" style="display:inline-block"></widget><br>',
			'Full Name: <widget is="!form/Input" value="{lastName}, {firstName}"></widget><br>',
			// '<if condition="true">',
			// 	'Name, full: <widget is="!form/Input" value="{firstName} {lastName}"></widget>',
			// '<elseif condition="1">',
			// 	'<widget is="!Placeholder"></widget>',
			// '<else>',
			// 	'NO',
			// '</if>',
			'<widget is="!form/Button" value="hello"><b><i>Submit</b> for {lastName}</i></widget>'
		].join('');
		var parser = new Parser({ app: app, mediator: mediator });
		parser.process(template).then(function(el) {
			masterView.add(el)
		});
	});
});
		</script>
	</body>
</html>
